'use strict';

var _component = require('./../common/component.js');

var _utils = require('./../common/utils.js');

var LONG_PRESS_START_TIME = 600;
var LONG_PRESS_INTERVAL = 200;
// add num and avoid float number
function add(num1, num2) {
    var cardinal = Math.pow(10, 10);
    return Math.round((num1 + num2) * cardinal) / cardinal;
}
(0, _component.VantComponent)({
    field: true,
    classes: ['input-class', 'plus-class', 'minus-class'],
    props: {
        value: null,
        integer: Boolean,
        disabled: Boolean,
        inputWidth: null,
        buttonSize: null,
        asyncChange: Boolean,
        disableInput: Boolean,
        decimalLength: {
            type: Number,
            value: null
        },
        min: {
            type: null,
            value: 1
        },
        max: {
            type: null,
            value: Number.MAX_SAFE_INTEGER
        },
        step: {
            type: null,
            value: 1
        },
        showPlus: {
            type: Boolean,
            value: true
        },
        showMinus: {
            type: Boolean,
            value: true
        },
        disablePlus: Boolean,
        disableMinus: Boolean
    },
    watch: {
        value: function value(_value) {
            if (_value === '') {
                return;
            }
            var newValue = this.range(_value);
            if (typeof newValue === 'number' && +this.data.value !== newValue) {
                this.setData({ value: newValue });
            }
        },
        inputWidth: function inputWidth() {
            this.set({
                inputStyle: this.computeInputStyle()
            });
        },
        buttonSize: function buttonSize() {
            this.set({
                inputStyle: this.computeInputStyle(),
                buttonStyle: this.computeButtonStyle()
            });
        }
    },
    data: {
        focus: false,
        inputStyle: '',
        buttonStyle: ''
    },
    created: function created() {
        this.setData({
            value: this.range(this.data.value)
        });
    },

    methods: {
        isDisabled: function isDisabled(type) {
            if (type === 'plus') {
                return this.data.disabled || this.data.disablePlus || this.data.value >= this.data.max;
            }
            return this.data.disabled || this.data.disableMinus || this.data.value <= this.data.min;
        },
        onFocus: function onFocus(event) {
            this.$emit('focus', event.detail);
        },
        onBlur: function onBlur(event) {
            var value = this.range(this.data.value);
            this.triggerInput(value);
            this.$emit('blur', event.detail);
        },

        // limit value range
        range: function range(value) {
            value = String(value).replace(/[^0-9.-]/g, '');
            // format range
            value = value === '' ? 0 : +value;
            value = Math.max(Math.min(this.data.max, value), this.data.min);
            // format decimal
            if ((0, _utils.isDef)(this.data.decimalLength)) {
                value = value.toFixed(this.data.decimalLength);
            }
            return value;
        },
        onInput: function onInput(event) {
            var _ref = event.detail || {},
                _ref$value = _ref.value,
                value = _ref$value === undefined ? '' : _ref$value;

            this.triggerInput(value);
        },
        onChange: function onChange() {
            var type = this.type;

            if (this.isDisabled(type)) {
                this.$emit('overlimit', type);
                return;
            }
            var diff = type === 'minus' ? -this.data.step : +this.data.step;
            var value = add(+this.data.value, diff);
            this.triggerInput(this.range(value));
            this.$emit(type);
        },
        longPressStep: function longPressStep() {
            var _this = this;

            this.longPressTimer = setTimeout(function () {
                _this.onChange();
                _this.longPressStep();
            }, LONG_PRESS_INTERVAL);
        },
        onTap: function onTap(event) {
            var type = event.currentTarget.dataset.type;

            this.type = type;
            this.onChange();
        },
        onTouchStart: function onTouchStart(event) {
            var _this2 = this;

            clearTimeout(this.longPressTimer);
            var type = event.currentTarget.dataset.type;

            this.type = type;
            this.isLongPress = false;
            this.longPressTimer = setTimeout(function () {
                _this2.isLongPress = true;
                _this2.onChange();
                _this2.longPressStep();
            }, LONG_PRESS_START_TIME);
        },
        onTouchEnd: function onTouchEnd() {
            clearTimeout(this.longPressTimer);
        },
        triggerInput: function triggerInput(value) {
            this.setData({
                value: this.data.asyncChange ? this.data.value : value
            });
            this.$emit('change', value);
        },
        computeInputStyle: function computeInputStyle() {
            var style = '';
            if (this.data.inputWidth) {
                style = 'width: ' + (0, _utils.addUnit)(this.data.inputWidth) + ';';
            }
            if (this.data.buttonSize) {
                style += 'height: ' + (0, _utils.addUnit)(this.data.buttonSize) + ';';
            }
            return style;
        },
        computeButtonStyle: function computeButtonStyle() {
            var style = '';
            var size = (0, _utils.addUnit)(this.data.buttonSize);
            if (this.data.buttonSize) {
                style = 'width: ' + size + ';height: ' + size + ';';
            }
            return style;
        }
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkxPTkdfUFJFU1NfU1RBUlRfVElNRSIsIkxPTkdfUFJFU1NfSU5URVJWQUwiLCJhZGQiLCJudW0xIiwibnVtMiIsImNhcmRpbmFsIiwiTWF0aCIsInBvdyIsInJvdW5kIiwiZmllbGQiLCJjbGFzc2VzIiwicHJvcHMiLCJ2YWx1ZSIsImludGVnZXIiLCJCb29sZWFuIiwiZGlzYWJsZWQiLCJpbnB1dFdpZHRoIiwiYnV0dG9uU2l6ZSIsImFzeW5jQ2hhbmdlIiwiZGlzYWJsZUlucHV0IiwiZGVjaW1hbExlbmd0aCIsInR5cGUiLCJOdW1iZXIiLCJtaW4iLCJtYXgiLCJNQVhfU0FGRV9JTlRFR0VSIiwic3RlcCIsInNob3dQbHVzIiwic2hvd01pbnVzIiwiZGlzYWJsZVBsdXMiLCJkaXNhYmxlTWludXMiLCJ3YXRjaCIsIm5ld1ZhbHVlIiwicmFuZ2UiLCJkYXRhIiwic2V0RGF0YSIsInNldCIsImlucHV0U3R5bGUiLCJjb21wdXRlSW5wdXRTdHlsZSIsImJ1dHRvblN0eWxlIiwiY29tcHV0ZUJ1dHRvblN0eWxlIiwiZm9jdXMiLCJjcmVhdGVkIiwibWV0aG9kcyIsImlzRGlzYWJsZWQiLCJvbkZvY3VzIiwiZXZlbnQiLCIkZW1pdCIsImRldGFpbCIsIm9uQmx1ciIsInRyaWdnZXJJbnB1dCIsIlN0cmluZyIsInJlcGxhY2UiLCJ0b0ZpeGVkIiwib25JbnB1dCIsIm9uQ2hhbmdlIiwiZGlmZiIsImxvbmdQcmVzc1N0ZXAiLCJsb25nUHJlc3NUaW1lciIsInNldFRpbWVvdXQiLCJvblRhcCIsImN1cnJlbnRUYXJnZXQiLCJkYXRhc2V0Iiwib25Ub3VjaFN0YXJ0IiwiY2xlYXJUaW1lb3V0IiwiaXNMb25nUHJlc3MiLCJvblRvdWNoRW5kIiwic3R5bGUiLCJzaXplIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBLElBQU1BLHdCQUF3QixHQUE5QjtBQUNBLElBQU1DLHNCQUFzQixHQUE1QjtBQUNBO0FBQ0EsU0FB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QUw7QUFDQSx1QkFBS0UsYUFBTDtBQUNILGFBSnFCLEVBSW5CekQscUJBSm1CLENBQXRCO0FBS0gsU0EvREk7QUFnRUxrRSxrQkFoRUssd0JBZ0VRO0FBQ1RGLHlCQUFhLEtBQUtOLGNBQWxCO0FBQ0gsU0FsRUk7QUFtRUxSLG9CQW5FSyx3QkFtRVF0QyxLQW5FUixFQW1FZTtBQUNoQixpQkFBS3VCLE9BQUwsQ0FBYTtBQUNUdkIsdUJBQU8sS0FBS3NCLElBQUwsQ0FBVWhCLFdBQVYsR0FBd0IsS0FBS2dCLElBQUwsQ0FBVXRCLEtBQWxDLEdBQTBDQTtBQUR4QyxhQUFiO0FBR0EsaUJBQUttQyxLQUFMLENBQVcsUUFBWCxFQUFxQm5DLEtBQXJCO0FBQ0gsU0F4RUk7QUF5RUwwQix5QkF6RUssK0JBeUVlO0FBQ2hCLGdCQUFJNkIsUUFBUSxFQUFaO0FBQ0EsZ0JBQUksS0FBS2pDLElBQUwsQ0FBVWxCLFVBQWQsRUFBMEI7QUFDdEJtRCxvQ0FBa0Isb0JBQVEsS0FBS2pDLElBQUwsQ0FBVWxCLFVBQWxCLENBQWxCO0FBQ0g7QUFDRCxnQkFBSSxLQUFLa0IsSUFBTCxDQUFVakIsVUFBZCxFQUEwQjtBQUN0QmtELHNDQUFvQixvQkFBUSxLQUFLakMsSUFBTCxDQUFVakIsVUFBbEIsQ0FBcEI7QUFDSDtBQUNELG1CQUFPa0QsS0FBUDtBQUNILFNBbEZJO0FBbUZMM0IsMEJBbkZLLGdDQW1GZ0I7QUFDakIsZ0JBQUkyQixRQUFRLEVBQVo7QUFDQSxnQkFBTUMsT0FBTyxvQkFBUSxLQUFLbEMsSUFBTCxDQUFVakIsVUFBbEIsQ0FBYjtBQUNBLGdCQUFJLEtBQUtpQixJQUFMLENBQVVqQixVQUFkLEVBQTBCO0FBQ3RCa0Qsb0NBQWtCQyxJQUFsQixpQkFBa0NBLElBQWxDO0FBQ0g7QUFDRCxtQkFBT0QsS0FBUDtBQUNIO0FBMUZJO0FBdEVDLENBQWQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYW50Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tbW9uL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBhZGRVbml0LCBpc0RlZiB9IGZyb20gJy4uL2NvbW1vbi91dGlscyc7XG5jb25zdCBMT05HX1BSRVNTX1NUQVJUX1RJTUUgPSA2MDA7XG5jb25zdCBMT05HX1BSRVNTX0lOVEVSVkFMID0gMjAwO1xuLy8gYWRkIG51bSBhbmQgYXZvaWQgZmxvYXQgbnVtYmVyXG5mdW5jdGlvbiBhZGQobnVtMSwgbnVtMikge1xuICAgIGNvbnN0IGNhcmRpbmFsID0gTWF0aC5wb3coMTAsIDEwKTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZCgobnVtMSArIG51bTIpICogY2FyZGluYWwpIC8gY2FyZGluYWw7XG59XG5WYW50Q29tcG9uZW50KHtcbiAgICBmaWVsZDogdHJ1ZSxcbiAgICBjbGFzc2VzOiBbJ2lucHV0LWNsYXNzJywgJ3BsdXMtY2xhc3MnLCAnbWludXMtY2xhc3MnXSxcbiAgICBwcm9wczoge1xuICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgaW50ZWdlcjogQm9vbGVhbixcbiAgICAgICAgZGlzYWJsZWQ6IEJvb2xlYW4sXG4gICAgICAgIGlucHV0V2lkdGg6IG51bGwsXG4gICAgICAgIGJ1dHRvblNpemU6IG51bGwsXG4gICAgICAgIGFzeW5jQ2hhbmdlOiBCb29sZWFuLFxuICAgICAgICBkaXNhYmxlSW5wdXQ6IEJvb2xlYW4sXG4gICAgICAgIGRlY2ltYWxMZW5ndGg6IHtcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgICAgICAgIHZhbHVlOiBudWxsXG4gICAgICAgIH0sXG4gICAgICAgIG1pbjoge1xuICAgICAgICAgICAgdHlwZTogbnVsbCxcbiAgICAgICAgICAgIHZhbHVlOiAxXG4gICAgICAgIH0sXG4gICAgICAgIG1heDoge1xuICAgICAgICAgICAgdHlwZTogbnVsbCxcbiAgICAgICAgICAgIHZhbHVlOiBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxuICAgICAgICB9LFxuICAgICAgICBzdGVwOiB7XG4gICAgICAgICAgICB0eXBlOiBudWxsLFxuICAgICAgICAgICAgdmFsdWU6IDFcbiAgICAgICAgfSxcbiAgICAgICAgc2hvd1BsdXM6IHtcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgICAgICB2YWx1ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBzaG93TWludXM6IHtcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXG4gICAgICAgICAgICB2YWx1ZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBkaXNhYmxlUGx1czogQm9vbGVhbixcbiAgICAgICAgZGlzYWJsZU1pbnVzOiBCb29sZWFuXG4gICAgfSxcbiAgICB3YXRjaDoge1xuICAgICAgICB2YWx1ZSh2YWx1ZSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gdGhpcy5yYW5nZSh2YWx1ZSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG5ld1ZhbHVlID09PSAnbnVtYmVyJyAmJiArdGhpcy5kYXRhLnZhbHVlICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7IHZhbHVlOiBuZXdWYWx1ZSB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW5wdXRXaWR0aCgpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICAgICAgICBpbnB1dFN0eWxlOiB0aGlzLmNvbXB1dGVJbnB1dFN0eWxlKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBidXR0b25TaXplKCkge1xuICAgICAgICAgICAgdGhpcy5zZXQoe1xuICAgICAgICAgICAgICAgIGlucHV0U3R5bGU6IHRoaXMuY29tcHV0ZUlucHV0U3R5bGUoKSxcbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZTogdGhpcy5jb21wdXRlQnV0dG9uU3R5bGUoKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgICBpbnB1dFN0eWxlOiAnJyxcbiAgICAgICAgYnV0dG9uU3R5bGU6ICcnXG4gICAgfSxcbiAgICBjcmVhdGVkKCkge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgdmFsdWU6IHRoaXMucmFuZ2UodGhpcy5kYXRhLnZhbHVlKVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgICAgaXNEaXNhYmxlZCh0eXBlKSB7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3BsdXMnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5kaXNhYmxlZCB8fCB0aGlzLmRhdGEuZGlzYWJsZVBsdXMgfHwgdGhpcy5kYXRhLnZhbHVlID49IHRoaXMuZGF0YS5tYXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmRpc2FibGVkIHx8IHRoaXMuZGF0YS5kaXNhYmxlTWludXMgfHwgdGhpcy5kYXRhLnZhbHVlIDw9IHRoaXMuZGF0YS5taW47XG4gICAgICAgIH0sXG4gICAgICAgIG9uRm9jdXMoZXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2ZvY3VzJywgZXZlbnQuZGV0YWlsKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25CbHVyKGV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMucmFuZ2UodGhpcy5kYXRhLnZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcklucHV0KHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2JsdXInLCBldmVudC5kZXRhaWwpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBsaW1pdCB2YWx1ZSByYW5nZVxuICAgICAgICByYW5nZSh2YWx1ZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBTdHJpbmcodmFsdWUpLnJlcGxhY2UoL1teMC05Li1dL2csICcnKTtcbiAgICAgICAgICAgIC8vIGZvcm1hdCByYW5nZVxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gJycgPyAwIDogK3ZhbHVlO1xuICAgICAgICAgICAgdmFsdWUgPSBNYXRoLm1heChNYXRoLm1pbih0aGlzLmRhdGEubWF4LCB2YWx1ZSksIHRoaXMuZGF0YS5taW4pO1xuICAgICAgICAgICAgLy8gZm9ybWF0IGRlY2ltYWxcbiAgICAgICAgICAgIGlmIChpc0RlZih0aGlzLmRhdGEuZGVjaW1hbExlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvRml4ZWQodGhpcy5kYXRhLmRlY2ltYWxMZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBvbklucHV0KGV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IHZhbHVlID0gJycgfSA9IGV2ZW50LmRldGFpbCB8fCB7fTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcklucHV0KHZhbHVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25DaGFuZ2UoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHR5cGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0Rpc2FibGVkKHR5cGUpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb3ZlcmxpbWl0JywgdHlwZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZGlmZiA9IHR5cGUgPT09ICdtaW51cycgPyAtdGhpcy5kYXRhLnN0ZXAgOiArdGhpcy5kYXRhLnN0ZXA7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGFkZCgrdGhpcy5kYXRhLnZhbHVlLCBkaWZmKTtcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlcklucHV0KHRoaXMucmFuZ2UodmFsdWUpKTtcbiAgICAgICAgICAgIHRoaXMuJGVtaXQodHlwZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGxvbmdQcmVzc1N0ZXAoKSB7XG4gICAgICAgICAgICB0aGlzLmxvbmdQcmVzc1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubG9uZ1ByZXNzU3RlcCgpO1xuICAgICAgICAgICAgfSwgTE9OR19QUkVTU19JTlRFUlZBTCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVGFwKGV2ZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IHR5cGUgfSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldDtcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVG91Y2hTdGFydChldmVudCkge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubG9uZ1ByZXNzVGltZXIpO1xuICAgICAgICAgICAgY29uc3QgeyB0eXBlIH0gPSBldmVudC5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7XG4gICAgICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAgICAgdGhpcy5pc0xvbmdQcmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5sb25nUHJlc3NUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNMb25nUHJlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmxvbmdQcmVzc1N0ZXAoKTtcbiAgICAgICAgICAgIH0sIExPTkdfUFJFU1NfU1RBUlRfVElNRSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uVG91Y2hFbmQoKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5sb25nUHJlc3NUaW1lcik7XG4gICAgICAgIH0sXG4gICAgICAgIHRyaWdnZXJJbnB1dCh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5kYXRhLmFzeW5jQ2hhbmdlID8gdGhpcy5kYXRhLnZhbHVlIDogdmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBjb21wdXRlSW5wdXRTdHlsZSgpIHtcbiAgICAgICAgICAgIGxldCBzdHlsZSA9ICcnO1xuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5pbnB1dFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgc3R5bGUgPSBgd2lkdGg6ICR7YWRkVW5pdCh0aGlzLmRhdGEuaW5wdXRXaWR0aCl9O2A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhLmJ1dHRvblNpemUpIHtcbiAgICAgICAgICAgICAgICBzdHlsZSArPSBgaGVpZ2h0OiAke2FkZFVuaXQodGhpcy5kYXRhLmJ1dHRvblNpemUpfTtgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xuICAgICAgICB9LFxuICAgICAgICBjb21wdXRlQnV0dG9uU3R5bGUoKSB7XG4gICAgICAgICAgICBsZXQgc3R5bGUgPSAnJztcbiAgICAgICAgICAgIGNvbnN0IHNpemUgPSBhZGRVbml0KHRoaXMuZGF0YS5idXR0b25TaXplKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuYnV0dG9uU2l6ZSkge1xuICAgICAgICAgICAgICAgIHN0eWxlID0gYHdpZHRoOiAke3NpemV9O2hlaWdodDogJHtzaXplfTtgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iXX0=