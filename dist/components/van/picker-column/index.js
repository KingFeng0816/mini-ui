'use strict';

var _component = require('./../common/component.js');

var _utils = require('./../common/utils.js');

var DEFAULT_DURATION = 200;
(0, _component.VantComponent)({
    classes: ['active-class'],
    props: {
        valueKey: String,
        className: String,
        itemHeight: Number,
        visibleItemCount: Number,
        initialOptions: {
            type: Array,
            value: []
        },
        defaultIndex: {
            type: Number,
            value: 0
        }
    },
    data: {
        startY: 0,
        offset: 0,
        duration: 0,
        startOffset: 0,
        options: [],
        currentIndex: 0
    },
    created: function created() {
        var _this = this;

        var _data = this.data,
            defaultIndex = _data.defaultIndex,
            initialOptions = _data.initialOptions;

        this.set({
            currentIndex: defaultIndex,
            options: initialOptions
        }).then(function () {
            _this.setIndex(defaultIndex);
        });
    },

    watch: {
        defaultIndex: function defaultIndex(value) {
            this.setIndex(value);
        }
    },
    methods: {
        getCount: function getCount() {
            return this.data.options.length;
        },
        onTouchStart: function onTouchStart(event) {
            this.setData({
                startY: event.touches[0].clientY,
                startOffset: this.data.offset,
                duration: 0
            });
        },
        onTouchMove: function onTouchMove(event) {
            var data = this.data;

            var deltaY = event.touches[0].clientY - data.startY;
            this.setData({
                offset: (0, _utils.range)(data.startOffset + deltaY, -(this.getCount() * data.itemHeight), data.itemHeight)
            });
        },
        onTouchEnd: function onTouchEnd() {
            var data = this.data;

            if (data.offset !== data.startOffset) {
                this.setData({ duration: DEFAULT_DURATION });
                var index = (0, _utils.range)(Math.round(-data.offset / data.itemHeight), 0, this.getCount() - 1);
                this.setIndex(index, true);
            }
        },
        onClickItem: function onClickItem(event) {
            var index = event.currentTarget.dataset.index;

            this.setIndex(index, true);
        },
        adjustIndex: function adjustIndex(index) {
            var data = this.data;

            var count = this.getCount();
            index = (0, _utils.range)(index, 0, count);
            for (var i = index; i < count; i++) {
                if (!this.isDisabled(data.options[i])) return i;
            }
            for (var _i = index - 1; _i >= 0; _i--) {
                if (!this.isDisabled(data.options[_i])) return _i;
            }
        },
        isDisabled: function isDisabled(option) {
            return (0, _utils.isObj)(option) && option.disabled;
        },
        getOptionText: function getOptionText(option) {
            var data = this.data;

            return (0, _utils.isObj)(option) && data.valueKey in option ? option[data.valueKey] : option;
        },
        setIndex: function setIndex(index, userAction) {
            var _this2 = this;

            var data = this.data;

            index = this.adjustIndex(index) || 0;
            var offset = -index * data.itemHeight;
            if (index !== data.currentIndex) {
                return this.set({ offset: offset, currentIndex: index }).then(function () {
                    userAction && _this2.$emit('change', index);
                });
            }
            return this.set({ offset: offset });
        },
        setValue: function setValue(value) {
            var options = this.data.options;

            for (var i = 0; i < options.length; i++) {
                if (this.getOptionText(options[i]) === value) {
                    return this.setIndex(i);
                }
            }
            return Promise.resolve();
        },
        getValue: function getValue() {
            var data = this.data;

            return data.options[data.currentIndex];
        }
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfRFVSQVRJT04iLCJjbGFzc2VzIiwicHJvcHMiLCJ2YWx1ZUtleSIsIlN0cmluZyIsImNsYXNzTmFtZSIsIml0ZW1IZWlnaHQiLCJOdW1iZXIiLCJ2aXNpYmxlSXRlbUNvdW50IiwiaW5pdGlhbE9wdGlvbnMiLCJ0eXBlIiwiQXJyYXkiLCJ2YWx1ZSIsImRlZmF1bHRJbmRleCIsImRhdGEiLCJzdGFydFkiLCJvZmZzZXQiLCJkdXJhdGlvbiIsInN0YXJ0T2Zmc2V0Iiwib3B0aW9ucyIsImN1cnJlbnRJbmRleCIsImNyZWF0ZWQiLCJzZXQiLCJ0aGVuIiwic2V0SW5kZXgiLCJ3YXRjaCIsIm1ldGhvZHMiLCJnZXRDb3VudCIsImxlbmd0aCIsIm9uVG91Y2hTdGFydCIsImV2ZW50Iiwic2V0RGF0YSIsInRvdWNoZXMiLCJjbGllbnRZIiwib25Ub3VjaE1vdmUiLCJkZWx0YVkiLCJvblRvdWNoRW5kIiwiaW5kZXgiLCJNYXRoIiwicm91bmQiLCJvbkNsaWNrSXRlbSIsImN1cnJlbnRUYXJnZXQiLCJkYXRhc2V0IiwiYWRqdXN0SW5kZXgiLCJjb3VudCIsImkiLCJpc0Rpc2FibGVkIiwib3B0aW9uIiwiZGlzYWJsZWQiLCJnZXRPcHRpb25UZXh0IiwidXNlckFjdGlvbiIsIiRlbWl0Iiwic2V0VmFsdWUiLCJQcm9taXNlIiwicmVzb2x2ZSIsImdldFZhbHVlIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOztBQUNBLElBQU1BLG1CQUFtQixHQUF6QjtBQUNBLDhCQUFjO0FBQ1ZDLGFBQVMsQ0FBQyxjQUFELENBREM7QUFFVkMsV0FBTztBQUNIQyxrQkFBVUMsTUFEUDtBQUVIQyxtQkFBV0QsTUFGUjtBQUdIRSxvQkFBWUMsTUFIVDtBQUlIQywwQkFBa0JELE1BSmY7QUFLSEUsd0JBQWdCO0FBQ1pDLGtCQUFNQyxLQURNO0FBRVpDLG1CQUFPO0FBRkssU0FMYjtBQVNIQyxzQkFBYztBQUNWSCxrQkFBTUgsTUFE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RUFBRU4sY0FBRixFQUFULENBQVA7QUFDSCxTQTlESTtBQStETG9DLGdCQS9ESyxvQkErREl4QyxLQS9ESixFQStEVztBQUFBLGdCQUNKTyxPQURJLEdBQ1EsS0FBS0wsSUFEYixDQUNKSyxPQURJOztBQUVaLGlCQUFLLElBQUkwQixJQUFJLENBQWIsRUFBZ0JBLElBQUkxQixRQUFRUyxNQUE1QixFQUFvQ2lCLEdBQXBDLEVBQXlDO0FBQ3JDLG9CQUFJLEtBQUtJLGFBQUwsQ0FBbUI5QixRQUFRMEIsQ0FBUixDQUFuQixNQUFtQ2pDLEtBQXZDLEVBQThDO0FBQzFDLDJCQUFPLEtBQUtZLFFBQUwsQ0FBY3FCLENBQWQsQ0FBUDtBQUNIO0FBQ0o7QUFDRCxtQkFBT1EsUUFBUUMsT0FBUixFQUFQO0FBQ0gsU0F2RUk7QUF3RUxDLGdCQXhFSyxzQkF3RU07QUFBQSxnQkFDQ3pDLElBREQsR0FDVSxJQURWLENBQ0NBLElBREQ7O0FBRVAsbUJBQU9BLEtBQUtLLE9BQUwsQ0FBYUwsS0FBS00sWUFBbEIsQ0FBUDtBQUNIO0FBM0VJO0FBdENDLENBQWQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYW50Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tbW9uL2NvbXBvbmVudCc7XG5pbXBvcnQgeyBpc09iaiwgcmFuZ2UgfSBmcm9tICcuLi9jb21tb24vdXRpbHMnO1xuY29uc3QgREVGQVVMVF9EVVJBVElPTiA9IDIwMDtcblZhbnRDb21wb25lbnQoe1xuICAgIGNsYXNzZXM6IFsnYWN0aXZlLWNsYXNzJ10sXG4gICAgcHJvcHM6IHtcbiAgICAgICAgdmFsdWVLZXk6IFN0cmluZyxcbiAgICAgICAgY2xhc3NOYW1lOiBTdHJpbmcsXG4gICAgICAgIGl0ZW1IZWlnaHQ6IE51bWJlcixcbiAgICAgICAgdmlzaWJsZUl0ZW1Db3VudDogTnVtYmVyLFxuICAgICAgICBpbml0aWFsT3B0aW9uczoge1xuICAgICAgICAgICAgdHlwZTogQXJyYXksXG4gICAgICAgICAgICB2YWx1ZTogW11cbiAgICAgICAgfSxcbiAgICAgICAgZGVmYXVsdEluZGV4OiB7XG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICAgICAgICB2YWx1ZTogMFxuICAgICAgICB9XG4gICAgfSxcbiAgICBkYXRhOiB7XG4gICAgICAgIHN0YXJ0WTogMCxcbiAgICAgICAgb2Zmc2V0OiAwLFxuICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgc3RhcnRPZmZzZXQ6IDAsXG4gICAgICAgIG9wdGlvbnM6IFtdLFxuICAgICAgICBjdXJyZW50SW5kZXg6IDBcbiAgICB9LFxuICAgIGNyZWF0ZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgZGVmYXVsdEluZGV4LCBpbml0aWFsT3B0aW9ucyB9ID0gdGhpcy5kYXRhO1xuICAgICAgICB0aGlzLnNldCh7XG4gICAgICAgICAgICBjdXJyZW50SW5kZXg6IGRlZmF1bHRJbmRleCxcbiAgICAgICAgICAgIG9wdGlvbnM6IGluaXRpYWxPcHRpb25zXG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRJbmRleChkZWZhdWx0SW5kZXgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHdhdGNoOiB7XG4gICAgICAgIGRlZmF1bHRJbmRleCh2YWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRJbmRleCh2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG1ldGhvZHM6IHtcbiAgICAgICAgZ2V0Q291bnQoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm9wdGlvbnMubGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBvblRvdWNoU3RhcnQoZXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgc3RhcnRZOiBldmVudC50b3VjaGVzWzBdLmNsaWVudFksXG4gICAgICAgICAgICAgICAgc3RhcnRPZmZzZXQ6IHRoaXMuZGF0YS5vZmZzZXQsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBvblRvdWNoTW92ZShldmVudCkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgZGVsdGFZID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRZIC0gZGF0YS5zdGFydFk7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIG9mZnNldDogcmFuZ2UoZGF0YS5zdGFydE9mZnNldCArIGRlbHRhWSwgLSh0aGlzLmdldENvdW50KCkgKiBkYXRhLml0ZW1IZWlnaHQpLCBkYXRhLml0ZW1IZWlnaHQpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25Ub3VjaEVuZCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gdGhpcztcbiAgICAgICAgICAgIGlmIChkYXRhLm9mZnNldCAhPT0gZGF0YS5zdGFydE9mZnNldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7IGR1cmF0aW9uOiBERUZBVUxUX0RVUkFUSU9OIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcmFuZ2UoTWF0aC5yb3VuZCgtZGF0YS5vZmZzZXQgLyBkYXRhLml0ZW1IZWlnaHQpLCAwLCB0aGlzLmdldENvdW50KCkgLSAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEluZGV4KGluZGV4LCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb25DbGlja0l0ZW0oZXZlbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5kZXggfSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQuZGF0YXNldDtcbiAgICAgICAgICAgIHRoaXMuc2V0SW5kZXgoaW5kZXgsIHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBhZGp1c3RJbmRleChpbmRleCkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmdldENvdW50KCk7XG4gICAgICAgICAgICBpbmRleCA9IHJhbmdlKGluZGV4LCAwLCBjb3VudCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXg7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzRGlzYWJsZWQoZGF0YS5vcHRpb25zW2ldKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gaW5kZXggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc0Rpc2FibGVkKGRhdGEub3B0aW9uc1tpXSkpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpc0Rpc2FibGVkKG9wdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGlzT2JqKG9wdGlvbikgJiYgb3B0aW9uLmRpc2FibGVkO1xuICAgICAgICB9LFxuICAgICAgICBnZXRPcHRpb25UZXh0KG9wdGlvbikge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIGlzT2JqKG9wdGlvbikgJiYgZGF0YS52YWx1ZUtleSBpbiBvcHRpb25cbiAgICAgICAgICAgICAgICA/IG9wdGlvbltkYXRhLnZhbHVlS2V5XVxuICAgICAgICAgICAgICAgIDogb3B0aW9uO1xuICAgICAgICB9LFxuICAgICAgICBzZXRJbmRleChpbmRleCwgdXNlckFjdGlvbikge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzO1xuICAgICAgICAgICAgaW5kZXggPSB0aGlzLmFkanVzdEluZGV4KGluZGV4KSB8fCAwO1xuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gLWluZGV4ICogZGF0YS5pdGVtSGVpZ2h0O1xuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSBkYXRhLmN1cnJlbnRJbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldCh7IG9mZnNldCwgY3VycmVudEluZGV4OiBpbmRleCB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckFjdGlvbiAmJiB0aGlzLiRlbWl0KCdjaGFuZ2UnLCBpbmRleCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXQoeyBvZmZzZXQgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAgICAgICBjb25zdCB7IG9wdGlvbnMgfSA9IHRoaXMuZGF0YTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldE9wdGlvblRleHQob3B0aW9uc1tpXSkgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldEluZGV4KGkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VmFsdWUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXM7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5vcHRpb25zW2RhdGEuY3VycmVudEluZGV4XTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIl19